<!-- BEGIN_TF_DOCS -->
## Requirements

| Name                                                                      | Version         |
|---------------------------------------------------------------------------|-----------------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3.0        |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm)       | >= 3.7.0, < 4.0 |

## Providers

| Name                                                          | Version         |
|---------------------------------------------------------------|-----------------|
| <a name="provider_azapi"></a> [azapi](#provider\_azapi)       | n/a             |
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | >= 3.7.0, < 4.0 |

## Modules

No modules.

## Resources

| Name                                                                                                                                                                              | Type     |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| [azapi_resource.routing_intent](https://registry.terraform.io/providers/Azure/azapi/latest/docs/resources/resource)                                                               | resource |
| [azurerm_express_route_connection.er_connection](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/express_route_connection)                        | resource |
| [azurerm_express_route_gateway.express_route_gateway](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/express_route_gateway)                      | resource |
| [azurerm_firewall.fw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/firewall)                                                                   | resource |
| [azurerm_point_to_site_vpn_gateway.p2s_gateway](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/point_to_site_vpn_gateway)                        | resource |
| [azurerm_resource_group.rg](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group)                                                       | resource |
| [azurerm_virtual_hub.virtual_hub](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_hub)                                                    | resource |
| [azurerm_virtual_hub_connection.hub_connection](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_hub_connection)                           | resource |
| [azurerm_virtual_wan.virtual_wan](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_wan)                                                    | resource |
| [azurerm_vpn_gateway.vpn_gateway](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/vpn_gateway)                                                    | resource |
| [azurerm_vpn_gateway_connection.vpn_site_connection](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/vpn_gateway_connection)                      | resource |
| [azurerm_vpn_server_configuration.p2s_gateway_vpn_server_configuration](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/vpn_server_configuration) | resource |
| [azurerm_vpn_site.vpn_site](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/vpn_site)                                                             | resource |

## Inputs

| Name                                                                                                                                                      | Description                                                                                                                       | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Default      | Required |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|:--------:|
| <a name="input_allow_branch_to_branch_traffic"></a> [allow\_branch\_to\_branch\_traffic](#input\_allow\_branch\_to\_branch\_traffic)                      | Switch to flip VWAN branch to branch traffic                                                                                      | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a          |   yes    |
| <a name="input_bgp_community"></a> [bgp\_community](#input\_bgp\_community)                                                                               | BGP community associated with the virtual network                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a          |   yes    |
| <a name="input_disable_vpn_encryption"></a> [disable\_vpn\_encryption](#input\_disable\_vpn\_encryption)                                                  | Switch to flip VWAN vpn encryption                                                                                                | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a          |   yes    |
| <a name="input_disable_vpn_site"></a> [disable\_vpn\_site](#input\_disable\_vpn\_site)                                                                    | Switch to flip S2S vpn site creation                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `false`      |    no    |
| <a name="input_er_circuit_connections"></a> [er\_circuit\_connections](#input\_er\_circuit\_connections)                                                  | Mapping object to link ER circuits to ER Gateways for the creation of connection                                                  | <pre>map(object({<br>    name                                 = string<br>    express_route_gateway_name           = string<br>    express_route_circuit_peering_id     = string<br>    authorization_key                    = optional(string)<br>    enable_internet_security             = optional(bool)<br>    express_route_gateway_bypass_enabled = optional(bool)<br>    routing = optional(object({<br>      associated_route_table_id = string<br>      propagated_route_table = optional(object({<br>        route_table_ids = optional(list(string))<br>        labels          = optional(list(string))<br>      }))<br>      inbound_route_map_id  = optional(string)<br>      outbound_route_map_id = optional(string)<br>    }))<br>    routing_weight = optional(number)<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `{}`         |    no    |
| <a name="input_express_route_connection_enabled"></a> [express\_route\_connection\_enabled](#input\_express\_route\_connection\_enabled)                  | Flag to enable/disable the creation of the Express Route Connection                                                               | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `false`      |    no    |
| <a name="input_expressroute_gateways"></a> [expressroute\_gateways](#input\_expressroute\_gateways)                                                       | Express Route Gateway parameters                                                                                                  | <pre>map(object({<br>    name                          = string<br>    virtual_hub                   = string<br>    tags                          = optional(map(string))<br>    allow_non_virtual_wan_traffic = optional(bool)<br>    scale_units                   = number<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`         |    no    |
| <a name="input_firewalls"></a> [firewalls](#input\_firewalls)                                                                                             | Azure Firewall parameters                                                                                                         | <pre>map(object({<br>    virtual_hub_name = string<br>    sku_name         = string<br>    sku_tier         = string<br>    # subnet_address_prefix = string<br>    # subnet_route_table_id = optional(string)<br>    name                 = optional(string)<br>    dns_servers          = optional(list(string))<br>    firewall_policy_id   = optional(string)<br>    private_ip_ranges    = optional(list(string))<br>    threat_intel_mode    = optional(string, "Alert")<br>    zones                = optional(list(string))<br>    vhub_public_ip_count = optional(string)<br>    tags                 = optional(map(string))<br>    default_ip_configuration = optional(object({<br>      name = optional(string)<br>      public_ip_config = optional(object({<br>        name       = optional(set(string))<br>        zones      = optional(set(string))<br>        ip_version = optional(string)<br>        sku_tier   = optional(string, "Regional")<br>      }))<br>    }))<br>    management_ip_configuration = optional(object({<br>      name                 = string<br>      subnet_id            = string<br>      public_ip_address_id = string<br>    }))<br>    ip_configuration = optional(object({<br>      name                 = string<br>      subnet_id            = string<br>      public_ip_address_id = string<br>    }))<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`         |    no    |
| <a name="input_location"></a> [location](#input\_location)                                                                                                | Virtual WAN location                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a          |   yes    |
| <a name="input_office365_local_breakout_category"></a> [office365\_local\_breakout\_category](#input\_office365\_local\_breakout\_category)               | Specifies the Office365 local breakout category. Possible values include: Optimize, OptimizeAndAllow, All, None. Defaults to None | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `"None"`     |    no    |
| <a name="input_p2s_gateway_vpn_server_configurations"></a> [p2s\_gateway\_vpn\_server\_configurations](#input\_p2s\_gateway\_vpn\_server\_configurations) | P2S VPN Gateway server configuration parameters                                                                                   | <pre>map(object({<br>    name                     = string<br>    virtual_hub_name         = string<br>    vpn_authentication_types = list(string)<br>    tags                     = optional(map(string))<br>    client_root_certificate = object({<br>      name             = string<br>      public_cert_data = string<br>    })<br>    ipsec_policy = optional(object({<br>      dh_group               = string<br>      ike_encryption         = string<br>      ike_integrity          = string<br>      ipsec_encryption       = string<br>      ipsec_integrity        = string<br>      pfs_group              = string<br>      sa_lifetime_seconds    = string<br>      sa_data_size_kilobytes = string<br>    }))<br>    vpn_protocols = optional(list(string))<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `{}`         |    no    |
| <a name="input_p2s_gateways"></a> [p2s\_gateways](#input\_p2s\_gateways)                                                                                  | P2S VPN Gateway parameters                                                                                                        | <pre>map(object({<br>    name                                      = string<br>    virtual_hub_name                          = string<br>    tags                                      = optional(map(string))<br>    p2s_gateway_vpn_server_configuration_name = string<br>    connection_configuration = object({<br>      name = string<br>      vpn_client_address_pool = object({<br>        address_prefixes = list(string)<br>      })<br>    })<br>    routing_preference                  = optional(string)<br>    scale_unit                          = number<br>    dns_servers                         = optional(list(string))<br>    routing_preference_internet_enabled = optional(bool)<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `{}`         |    no    |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name)                                                           | Virutal WAN Resource group name                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a          |   yes    |
| <a name="input_resource_group_tags"></a> [resource\_group\_tags](#input\_resource\_group\_tags)                                                           | Virtual WAN Resource group tags                                                                                                   | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`         |    no    |
| <a name="input_routing_intents"></a> [routing\_intents](#input\_routing\_intents)                                                                         | Routing intent for virutal hubs                                                                                                   | <pre>map(object({<br>    type                 = string<br>    name                 = string<br>    virtual_hub_name     = string<br>    policy_name          = string       # Name of the policy<br>    policy_destinations  = list(string) # Private and/or Internet<br>    policy_nexthop       = string       # Azure Firewall name<br>    remove_special_chars = optional(string)<br>    location             = optional(string)<br>    identity = optional(object({<br>      type         = string<br>      identity_ids = list(string)<br>    }))<br>    tags                      = optional(map(string))<br>    response_export_values    = optional(list(string))<br>    locks                     = optional(list(string))<br>    ignore_casing             = optional(bool)<br>    ignore_missing_property   = optional(bool)<br>    schema_validation_enabled = optional(bool)<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `{}`         |    no    |
| <a name="input_tags"></a> [tags](#input\_tags)                                                                                                            | Overall tags                                                                                                                      | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`         |    no    |
| <a name="input_type"></a> [type](#input\_type)                                                                                                            | Type of the virtual WAN                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `"Standard"` |    no    |
| <a name="input_virtual_hubs"></a> [virtual\_hubs](#input\_virtual\_hubs)                                                                                  | Virtual Hub parameters                                                                                                            | <pre>map(object({<br>    name           = string<br>    location       = string<br>    resource_group = optional(string, null)<br>    address_prefix = string<br>    tags           = optional(map(string))<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `{}`         |    no    |
| <a name="input_virtual_network_connections"></a> [virtual\_network\_connections](#input\_virtual\_network\_connections)                                   | Azure virtual network connections                                                                                                 | <pre>map(object({<br>    name                      = string<br>    virtual_hub_name          = string<br>    remote_virtual_network_id = string<br>    internet_security_enabled = optional(bool)<br>    routing = optional(object({<br>      associated_route_table_id = string<br>      propagated_route_table = optional(object({<br>        route_table_ids = optional(list(string))<br>        labels          = optional(list(string))<br>      }))<br>      static_vnet_route = optional(object({<br>        name                = optional(string)<br>        address_prefixes    = optional(list(string))<br>        next_hop_ip_address = optional(string)<br>      }))<br>    }))<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `{}`         |    no    |
| <a name="input_virtual_wan_name"></a> [virtual\_wan\_name](#input\_virtual\_wan\_name)                                                                    | Virtual WAN name                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a          |   yes    |
| <a name="input_virtual_wan_tags"></a> [virtual\_wan\_tags](#input\_virtual\_wan\_tags)                                                                    | Virtual WAN tags                                                                                                                  | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`         |    no    |
| <a name="input_vpn_gateways"></a> [vpn\_gateways](#input\_vpn\_gateways)                                                                                  | S2S VPN Gateway parameters                                                                                                        | <pre>map(object({<br>    name                                  = string<br>    virtual_hub                           = string // Name of the virtual hub<br>    tags                                  = optional(map(string))<br>    bgp_route_translation_for_nat_enabled = optional(bool)<br>    bgp_settings = optional(object({<br>      asn                            = number<br>      instance_0_bgp_peering_address = optional(string)<br>      instance_1_bgp_peering_address = optional(string)<br>      peer_weight                    = number<br>    }))<br>    routing_preference = optional(string)<br>    scale_unit         = optional(number)<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `{}`         |    no    |
| <a name="input_vpn_site_connections"></a> [vpn\_site\_connections](#input\_vpn\_site\_connections)                                                        | S2S VPN Site Connections parameter                                                                                                | <pre>map(object({<br>    name                 = string<br>    vpn_gateway_name     = string // Name of the vpn gateway<br>    remote_vpn_site_name = string // Name of the vpn site<br>    vpn_links = list(object({<br>      name                 = string<br>      egress_nat_rule_ids  = optional(list(string))<br>      ingress_nat_rule_ids = optional(list(string))<br>      vpn_site_link_number = number // Index of the link on the remote vpn site<br>      bandwidth_mbps       = optional(number)<br>      bgp_enabled          = optional(bool)<br>      connection_mode      = optional(string)<br><br>      ipsec_policy = optional(object({<br>        dh_group                 = string<br>        ike_encryption_algorithm = string<br>        ike_integrity_algorithm  = string<br>        encryption_algorithm     = string<br>        integrity_algorithm      = string<br>        pfs_group                = string<br>        sa_data_size_kb          = string<br>        sa_lifetime_sec          = string<br>      }))<br>      protocol                              = optional(string)<br>      ratelimit_enabled                     = optional(bool)<br>      route_weight                          = optional(number)<br>      shared_key                            = optional(string)<br>      local_azure_ip_address_enabled        = optional(bool)<br>      policy_based_traffic_selector_enabled = optional(bool)<br>      custom_bgp_address = optional(list(object({<br>        ip_address          = string<br>        ip_configuration_id = string<br>      })))<br>    }))<br>    internet_security_enabled = optional(bool)<br>    routing = optional(object({<br>      associated_route_table = string<br>      propagated_route_table = optional(object({<br>        route_table_ids = optional(list(string))<br>        labels          = optional(list(string))<br>      }))<br>      inbound_route_map_id  = optional(string)<br>      outbound_route_map_id = optional(string)<br>    }))<br>    traffic_selector_policy = optional(object({<br>      local_address_ranges  = string<br>      remote_address_ranges = string<br>    }))<br>  }))</pre> | `{}`         |    no    |
| <a name="input_vpn_sites"></a> [vpn\_sites](#input\_vpn\_sites)                                                                                           | S2S VPN Sites parameter                                                                                                           | <pre>map(object({<br>    name             = string<br>    virtual_hub_name = string // Name of the virtual hub<br>    links = list(object({<br>      name = string<br>      bgp = optional(object({<br>        asn             = number<br>        peering_address = string<br>      }))<br>      fqdn          = optional(string)<br>      ip_address    = optional(string)<br>      provider_name = optional(string)<br>      speed_in_mbps = optional(number)<br>      }<br>    ))<br>    address_cidrs = optional(list(string))<br>    device_model  = optional(string)<br>    device_vendor = optional(string)<br>    o365_policy = optional(object({<br>      traffic_category = object({<br>        allow_endpoint_enabled    = optional(bool)<br>        default_endpoint_enabled  = optional(bool)<br>        optimize_endpoint_enabled = optional(bool)<br>      })<br>    }))<br>    tags = optional(map(string))<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `{}`         |    no    |

## Outputs

| Name                                                                               | Description             |
|------------------------------------------------------------------------------------|-------------------------|
| <a name="output_er_gw_id"></a> [er\_gw\_id](#output\_er\_gw\_id)                   | ExpressRoute Gateway ID |
| <a name="output_fw"></a> [fw](#output\_fw)                                         | Firewall Name           |
| <a name="output_p2s_vpn_gw_id"></a> [p2s\_vpn\_gw\_id](#output\_p2s\_vpn\_gw\_id)  | P2S VPN Gateway ID      |
| <a name="output_rg"></a> [rg](#output\_rg)                                         | Resource Group Name     |
| <a name="output_s2s_vpn_gw_id"></a> [s2s\_vpn\_gw\_id](#output\_s2s\_vpn\_gw\_id)  | S2S VPN Gateway ID      |
| <a name="output_virtual_hub_id"></a> [virtual\_hub\_id](#output\_virtual\_hub\_id) | Virtual Hub ID          |
| <a name="output_virtual_wan_id"></a> [virtual\_wan\_id](#output\_virtual\_wan\_id) | Virtual WAN ID          |
<!-- END_TF_DOCS -->
